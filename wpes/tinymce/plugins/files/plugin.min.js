
tinymce.PluginManager.add('files', function(editor, url) {
    // Add a button that opens a window
	var self = this, button;
	 function getValues() {
      return editor.settings.myKeyValueList;
   }
    editor.addButton('files', {
        text: 'List Files',
        icon: false,
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'List Uploaded File',
                   
                      name: 'input1', type: 'listbox' , values: getValues()
    ,
              
				
                onsubmit: function(e) {
                    // Insert content when the window form is submitted
                    editor.insertContent( e.data.input1);
                  },
				 onselect: function() {
         //insert key
         editor.insertContent(this.value());

         //reset selected value
         this.value(null);
      },
      onPostRender: function() {
         //this is a hack to get button refrence.
         //there may be a better way to do this
         button = this;
      } 
			
            });
        }
		
    });
	
self.refresh = function() {
      //remove existing menu if it is already rendered
      if(this.menu){
         this.menu.remove();
         this.menu = null;
      }

    this.settings.values = this.settings.menu = getValues();
   };
});


$.ajax({

                type: "GET",
                url: "getfiles.php",
                success: function(data){

for (var x = 0; x < data.length; x++) {

tinyMCE.activeEditor.settings.myKeyValueList = [{text: data[name], value: data[descrip]}];

}
tinyMCE.activeEditor.plugins.files.refresh();
}

});


